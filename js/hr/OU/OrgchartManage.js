/**
 * Created by adithep on 10/7/2017 AD.
 */

var dataAA = [{ "id": "1773", "name": "ผู้จัดการอาวุโส", "company": "56", "title": "ผู้จัดการอาวุโส", "parent": "0", "Emp_id": "413", "idPosition": "1773", "active_status": "1" }, { "id": "1043", "name": "ที่ปรึกษาอาวุโส", "company": "56", "title": "ที่ปรึกษาอาวุโส", "parent": "1010", "Emp_id": null, "idPosition": "1043", "active_status": "1" }, { "id": "1018", "name": "Acting senior manager", "company": "56", "title": "Acting senior manager", "parent": "1010", "Emp_id": null, "idPosition": "1018", "active_status": "1" }, { "id": "1019", "name": "Senior developer", "company": "56", "title": "Senior developer", "parent": "1018", "Emp_id": "287", "idPosition": "1019", "active_status": "1" }, { "id": "1027", "name": "Developer", "company": "56", "title": "Developer", "parent": "1018", "Emp_id": "1518", "idPosition": "1027", "active_status": "1" }, { "id": "1021", "name": "Developer", "company": "56", "title": "Developer", "parent": "1018", "Emp_id": "1603", "idPosition": "1021", "active_status": "1" }, { "id": "1032", "name": "Developer", "company": "56", "title": "Developer", "parent": "1018", "Emp_id": "1638", "idPosition": "1032", "active_status": "1" }, { "id": "1026", "name": "Developer", "company": "56", "title": "Developer", "parent": "1018", "Emp_id": "1655", "idPosition": "1026", "active_status": "1" }, { "id": "1036", "name": "System Analyze", "company": "56", "title": "System Analyze", "parent": "1018", "Emp_id": "1690", "idPosition": "1036", "active_status": "1" }, { "id": "1028", "name": "Developer", "company": "56", "title": "Developer", "parent": "1018", "Emp_id": "1857", "idPosition": "1028", "active_status": "1" }, { "id": "1137", "name": "Developer", "company": "56", "title": "Developer", "parent": "1018", "Emp_id": "1858", "idPosition": "1137", "active_status": "1" }, { "id": "1146", "name": "System Analyze", "company": "56", "title": "System Analyze", "parent": "1018", "Emp_id": "1873", "idPosition": "1146", "active_status": "1" }, { "id": "1153", "name": "Developer", "company": "56", "title": "Developer", "parent": "1018", "Emp_id": "1893", "idPosition": "1153", "active_status": "1" }, { "id": "1154", "name": "Developer", "company": "56", "title": "Developer", "parent": "1018", "Emp_id": "1894", "idPosition": "1154", "active_status": "1" }, { "id": "1151", "name": "System Analyze", "company": "56", "title": "System Analyze", "parent": "1018", "Emp_id": "2018", "idPosition": "1151", "active_status": "1" }, { "id": "1150", "name": "System Analyze", "company": "56", "title": "System Analyze", "parent": "1018", "Emp_id": "2283", "idPosition": "1150", "active_status": "1" }, { "id": "1022", "name": "System Analyze", "company": "56", "title": "System Analyze", "parent": "1018", "Emp_id": null, "idPosition": "1022", "active_status": "1" }, { "id": "1024", "name": "Senior developer", "company": "56", "title": "Senior developer", "parent": "1018", "Emp_id": null, "idPosition": "1024", "active_status": "1" }, { "id": "1025", "name": "Developer", "company": "56", "title": "Developer", "parent": "1018", "Emp_id": null, "idPosition": "1025", "active_status": "1" }, { "id": "1148", "name": " Senior system analyze", "company": "56", "title": " Senior system analyze", "parent": "1018", "Emp_id": null, "idPosition": "1148", "active_status": "1" }, { "id": "1152", "name": "System Analyze", "company": "56", "title": "System Analyze", "parent": "1018", "Emp_id": null, "idPosition": "1152", "active_status": "1" }, { "id": "1046", "name": "Implementer", "company": "56", "title": "Implementer", "parent": "1043", "Emp_id": "1671", "idPosition": "1046", "active_status": "1" }, { "id": "1051", "name": "Help desk", "company": "56", "title": "Help desk", "parent": "1043", "Emp_id": "1672", "idPosition": "1051", "active_status": "1" }, { "id": "1038", "name": "Documenter", "company": "56", "title": "Documenter", "parent": "1043", "Emp_id": "1689", "idPosition": "1038", "active_status": "1" }, { "id": "1052", "name": "Help desk", "company": "56", "title": "Help desk", "parent": "1043", "Emp_id": "1719", "idPosition": "1052", "active_status": "1" }, { "id": "1047", "name": "Implementer", "company": "56", "title": "Implementer", "parent": "1043", "Emp_id": "1753", "idPosition": "1047", "active_status": "1" }, { "id": "1045", "name": "Implementer", "company": "56", "title": "Implementer", "parent": "1043", "Emp_id": "1798", "idPosition": "1045", "active_status": "1" }, { "id": "1048", "name": "Implementer", "company": "56", "title": "Implementer", "parent": "1043", "Emp_id": "1804", "idPosition": "1048", "active_status": "1" }, { "id": "1156", "name": "Implementer", "company": "56", "title": "Implementer", "parent": "1043", "Emp_id": "1890", "idPosition": "1156", "active_status": "1" }, { "id": "1049", "name": "Implementer", "company": "56", "title": "Implementer", "parent": "1043", "Emp_id": "2079", "idPosition": "1049", "active_status": "1" }, { "id": "1354", "name": "Implementer", "company": "56", "title": "Implementer", "parent": "1043", "Emp_id": "2198", "idPosition": "1354", "active_status": "1" }, { "id": "1158", "name": "Implementer", "company": "56", "title": "Implementer", "parent": "1043", "Emp_id": "2199", "idPosition": "1158", "active_status": "1" }, { "id": "1157", "name": "Implementer", "company": "56", "title": "Implementer", "parent": "1043", "Emp_id": null, "idPosition": "1157", "active_status": "1" }, { "id": "1423", "name": "Implementer", "company": "56", "title": "Implementer", "parent": "1043", "Emp_id": null, "idPosition": "1423", "active_status": "1" }, { "id": "1424", "name": "Implementer", "company": "56", "title": "Implementer", "parent": "1043", "Emp_id": null, "idPosition": "1424", "active_status": "1" }, { "id": "1770", "name": "ผู้จัดการฝ่าย", "company": "56", "title": "ผู้จัดการฝ่าย", "parent": "1114", "Emp_id": "583", "idPosition": "1770", "active_status": "1" }, { "id": "1774", "name": "ผู้จัดการอาวุโส", "company": "56", "title": "ผู้จัดการอาวุโส", "parent": "1114", "Emp_id": "2533", "idPosition": "1774", "active_status": "1" }, { "id": "1793", "name": "ผู้จัดการอาวุโส", "company": "56", "title": "ผู้จัดการอาวุโส", "parent": "1114", "Emp_id": null, "idPosition": "1793", "active_status": "1" }, { "id": "1014", "name": "Manager", "company": "56", "title": "Manager", "parent": "1207", "Emp_id": null, "idPosition": null, "active_status": "1" }, { "id": "1771", "name": "คอมพิวเตอร์อาวุโส", "company": "56", "title": "คอมพิวเตอร์อาวุโส", "parent": "1770", "Emp_id": "1714", "idPosition": "1771", "active_status": "1" }, { "id": "1772", "name": "คอมพิวเตอร์", "company": "56", "title": "คอมพิวเตอร์", "parent": "1770", "Emp_id": "2657", "idPosition": "1772", "active_status": "1" }, { "id": "1783", "name": "Developer", "company": "56", "title": "Developer", "parent": "1773", "Emp_id": "214", "idPosition": "1783", "active_status": "1" }, { "id": "1784", "name": "Developer", "company": "56", "title": "Developer", "parent": "1773", "Emp_id": "1493", "idPosition": "1784", "active_status": "1" }, { "id": "1208", "name": "Tester", "company": "56", "title": "Tester", "parent": "1773", "Emp_id": "1564", "idPosition": "1208", "active_status": "1" }, { "id": "1777", "name": "Senior System Analize", "company": "56", "title": "Senior System Analize", "parent": "1773", "Emp_id": "1565", "idPosition": "1777", "active_status": "1" }, { "id": "1786", "name": "Developer", "company": "56", "title": "Developer", "parent": "1773", "Emp_id": "1764", "idPosition": "1786", "active_status": "1" }, { "id": "1775", "name": "System Analize", "company": "56", "title": "System Analize", "parent": "1773", "Emp_id": "1866", "idPosition": "1775", "active_status": "1" }, { "id": "1778", "name": "System Analize", "company": "56", "title": "System Analize", "parent": "1773", "Emp_id": "1874", "idPosition": "1778", "active_status": "1" }, { "id": "1209", "name": "Tester", "company": "56", "title": "Tester", "parent": "1773", "Emp_id": "1889", "idPosition": "1209", "active_status": "1" }, { "id": "1207", "name": "Tester", "company": "56", "title": "Tester", "parent": "1773", "Emp_id": "1974", "idPosition": "1207", "active_status": "1" }, { "id": "1785", "name": "Developer", "company": "56", "title": "Developer", "parent": "1773", "Emp_id": "2628", "idPosition": "1785", "active_status": "1" }, { "id": "1782", "name": "Developer", "company": "56", "title": "Developer", "parent": "1773", "Emp_id": "2664", "idPosition": "1782", "active_status": "1" }, { "id": "1787", "name": "Developer", "company": "56", "title": "Developer", "parent": "1773", "Emp_id": "2675", "idPosition": "1787", "active_status": "1" }, { "id": "1210", "name": "Tester", "company": "56", "title": "Tester", "parent": "1773", "Emp_id": null, "idPosition": "1210", "active_status": "1" }, { "id": "1776", "name": "System Analize", "company": "56", "title": "System Analize", "parent": "1773", "Emp_id": null, "idPosition": "1776", "active_status": "1" }, { "id": "1779", "name": "System Analize", "company": "56", "title": "System Analize", "parent": "1774", "Emp_id": "1875", "idPosition": "1779", "active_status": "1" }, { "id": "1211", "name": "Tester", "company": "56", "title": "Tester", "parent": "1774", "Emp_id": "1895", "idPosition": "1211", "active_status": "1" }, { "id": "1788", "name": "Developer", "company": "56", "title": "Developer", "parent": "1774", "Emp_id": "2626", "idPosition": "1788", "active_status": "1" }, { "id": "1791", "name": "Tester", "company": "56", "title": "Tester", "parent": "1774", "Emp_id": "2630", "idPosition": "1791", "active_status": "1" }, { "id": "1781", "name": "System Analize", "company": "56", "title": "System Analize", "parent": "1774", "Emp_id": "2676", "idPosition": "1781", "active_status": "1" }, { "id": "1789", "name": "Developer", "company": "56", "title": "Developer", "parent": "1774", "Emp_id": "2698", "idPosition": "1789", "active_status": "1" }, { "id": "1780", "name": "System Analize", "company": "56", "title": "System Analize", "parent": "1774", "Emp_id": null, "idPosition": "1780", "active_status": "1" }, { "id": "1790", "name": "Developer", "company": "56", "title": "Developer", "parent": "1774", "Emp_id": null, "idPosition": "1790", "active_status": "1" }, { "id": "1792", "name": "Tester", "company": "56", "title": "Tester", "parent": "1774", "Emp_id": null, "idPosition": "1792", "active_status": "1" }, { "id": "1798", "name": "Implementer", "company": "56", "title": "Implementer", "parent": "1793", "Emp_id": "231", "idPosition": "1798", "active_status": "1" }, { "id": "1797", "name": "Implementer", "company": "56", "title": "Implementer", "parent": "1793", "Emp_id": "1822", "idPosition": "1797", "active_status": "1" }, { "id": "1801", "name": "Implementer", "company": "56", "title": "Implementer", "parent": "1793", "Emp_id": "1891", "idPosition": "1801", "active_status": "1" }, { "id": "1808", "name": "Document", "company": "56", "title": "Document", "parent": "1793", "Emp_id": "2119", "idPosition": "1808", "active_status": "1" }, { "id": "1800", "name": "Implementer", "company": "56", "title": "Implementer", "parent": "1793", "Emp_id": "2200", "idPosition": "1800", "active_status": "1" }, { "id": "1802", "name": "Implementer", "company": "56", "title": "Implementer", "parent": "1793", "Emp_id": "2300", "idPosition": "1802", "active_status": "1" }, { "id": "1794", "name": "Implementer", "company": "56", "title": "Implementer", "parent": "1793", "Emp_id": "2307", "idPosition": "1794", "active_status": "1" }, { "id": "1806", "name": "Marketing", "company": "56", "title": "Marketing", "parent": "1793", "Emp_id": "2514", "idPosition": "1806", "active_status": "1" }, { "id": "1795", "name": "Implementer", "company": "56", "title": "Implementer", "parent": "1793", "Emp_id": null, "idPosition": "1795", "active_status": "1" }, { "id": "1796", "name": "Implementer", "company": "56", "title": "Implementer", "parent": "1793", "Emp_id": null, "idPosition": "1796", "active_status": "1" }, { "id": "1799", "name": "Implementer", "company": "56", "title": "Implementer", "parent": "1793", "Emp_id": null, "idPosition": "1799", "active_status": "1" }, { "id": "1803", "name": "Implementer", "company": "56", "title": "Implementer", "parent": "1793", "Emp_id": null, "idPosition": "1803", "active_status": "1" }, { "id": "1804", "name": "Help desk", "company": "56", "title": "Help desk", "parent": "1793", "Emp_id": null, "idPosition": "1804", "active_status": "1" }, { "id": "1805", "name": "Help desk", "company": "56", "title": "Help desk", "parent": "1793", "Emp_id": null, "idPosition": "1805", "active_status": "1" }, { "id": "1807", "name": "Marketing", "company": "56", "title": "Marketing", "parent": "1793", "Emp_id": null, "idPosition": "1807", "active_status": "1" }];
var testData = [];
$.ajaxSetup({
    async: false
});
$(document).ready(function() {
    nodeDataArray = [];
    var id = 56;

    var data = $.get('getchartnode', { company: id }, function(res) {
        $.each(res, function(index, value) {
            obj = {};
            if (value.parent == 0) {
                obj.id = value.ref_id;
                obj.name = value.name;
                obj.company = value.Company;
                obj.title = value.name;
                obj.parent = '0';
                obj.Emp_id = value.Emp_id;
                obj.idPosition = value.Posision_id;
                obj.active_status = value.active_status;
                obj.img = value.img;
            } else {
                obj.id = value.ref_id;
                obj.name = value.name;
                obj.company = value.Company;
                obj.title = value.name;
                obj.parent = value.parent;
                obj.Emp_id = value.Emp_id;
                obj.idPosition = value.Posision_id;
                obj.active_status = value.active_status;
                obj.img = value.img;
            }
            testData[index] = obj;
        });
    });
    var jstring = JSON.stringify(testData);
    console.log(jstring);
    org_chart = $('#orgChart').orgChart({
        data: testData,
        showControls: true,
        allowEdit: true,
        async: true,
        onAddNode: function(node, newnode = null) {
            console.log(newnode);
            if (newnode == 'add-node') {
                // $('#myModal').modal('show');
                org_chart.newNode(node.data);
            } else {
                org_chart.newNode(node.data.id);
            }
        },
        onDeleteNode: function(node) {
            //log('Deleted node '+node.data.id);
            org_chart.deleteNode(node.data.id);
        },
        onClickNode: function(node) {
            $('#myModal').modal('show');
        },

    });

});

// just for example purpose
function log(text) {
    $('#consoleOutput').append('<p>' + text + '</p>')
}